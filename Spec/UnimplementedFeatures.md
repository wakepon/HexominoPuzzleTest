# 未実装機能一覧

本ドキュメントは、`JSVersionSpec/` に記載された仕様と現行プロジェクトの実装状況を比較し、まだ実装されていない機能をまとめたものです。

**作成日**: 2026-02-09

---

## 1. レリックシステム（7種類未実装）

### 概要

JSVersionSpecでは10種類のレリックが定義されているが、現行プロジェクトでは3種類のみ実装済み。

### 実装済みレリック（3種類）

| ID | 名前 | 効果 |
|----|------|------|
| `full_clear_bonus` | 全消しボーナス | 盤面を全て空にするとスコア+20 |
| `small_luck` | 小さな幸運 | 3ブロックのピースでライン消去時+20点 |
| `chain_master` | 連鎖の達人 | 複数行列を同時消しでスコア×1.5 |

### 未実装レリック（7種類）

| ID | 名前 | レアリティ | 価格 | 効果 |
|----|------|-----------|------|------|
| `hand_stock` | 手札ストック | rare | 6G | ブロックセットを1つ保管できるストック枠が出現 |
| `single_line` | シングルライン | common | 4G | 1行または1列のみ消した時、スコアが3倍 |
| `takenoko` | タケノコ | common | 4G | 縦列のみ揃った時、スコアが揃った列数倍 |
| `kani` | カニ | common | 4G | 横列のみ揃った時、スコアが揃った行数倍 |
| `nobi_takenoko` | のびのびタケノコ | rare | 7G | 縦列のみ揃えるたびに倍率が0.5ずつ上昇（横列消しでリセット） |
| `nobi_kani` | のびのびカニ | rare | 7G | 横列のみ揃えるたびに倍率が0.5ずつ上昇（縦列消しでリセット） |
| `rensha` | 連射 | rare | 7G | 行・列が揃うたびにスコア倍率が0.5ずつ上昇（揃わないとリセット） |

### 未実装レリックの詳細仕様

#### hand_stock（手札ストック）

**効果詳細**:
- ストック枠が画面に表示される
- 手札からブロックをドラッグしてストックに移動可能
- ストックにブロックがある状態で新しいブロックを入れるとスワップ
- ラウンド開始時にストックはリセットされる
- レリック削除時はストックのブロックが手札に戻る

**必要なUI実装**:
- ストック枠コンテナの描画
- ストック枠へのドラッグ&ドロップ対応
- スワップアニメーション

#### single_line（シングルライン）

**発動条件**: 消去ライン数が1（行または列が1本のみ）

**効果計算**: `finalScore = baseScore × 3`

#### takenoko（タケノコ）

**発動条件**:
- 横列（行）の消去が0本
- 縦列の消去が1本以上

**効果計算**: `finalScore = baseScore × colLines`

#### kani（カニ）

**発動条件**:
- 縦列の消去が0本
- 横列（行）の消去が1本以上

**効果計算**: `finalScore = baseScore × rowLines`

#### nobi_takenoko（のびのびタケノコ）

**効果**:
- 初期倍率: 1.0
- 縦列のみ揃えるたびに +0.5
- 横列が1本でも揃うと倍率リセット（1.0に戻る）
- ラウンド開始時にリセット

**状態管理**: `nobiTakenokoMultiplier: number` をPlayerStateまたはGameStateに追加

**ツールチップ**: 現在の倍率を表示

#### nobi_kani（のびのびカニ）

**効果**:
- 初期倍率: 1.0
- 横列のみ揃えるたびに +0.5
- 縦列が1本でも揃うと倍率リセット（1.0に戻る）
- ラウンド開始時にリセット

**状態管理**: `nobiKaniMultiplier: number` をPlayerStateまたはGameStateに追加

**ツールチップ**: 現在の倍率を表示

#### rensha（連射）

**効果**:
- 初期倍率: 1.0
- ラインが揃うたびに現在の倍率を適用し、その後 +0.5
- ライン消去なしの配置で倍率リセット（1.0に戻る）
- ラウンド開始時にリセット

**状態管理**: `renshaMultiplier: number` をPlayerStateまたはGameStateに追加

**ツールチップ**: 次回の倍率を表示

### 効果適用順序（仕様）

1. 基本スコア計算 `(baseBlocks + auraBonus + mossBonus) × totalLines`
2. 連鎖の達人（×1.5、切り捨て）
3. シングルライン（×3）
4. タケノコ（×縦列数）
5. カニ（×横列数）
6. のびのびタケノコ（×倍率、切り捨て）
7. のびのびカニ（×倍率、切り捨て）
8. 連射（×倍率、切り捨て）
9. スコアアニメーション
10. 小さな幸運（+20）
11. 全消しボーナス（+20）

---

## 2. ストック機能（hand_stockレリック関連）

### 概要

`hand_stock` レリック所持時に表示されるストック枠機能。現行プロジェクトでは未実装。

### 必要な実装

#### UI描画

- ストック枠コンテナの配置（手札エリアの近く）
- ストック枠スロットの描画
- 「ストック」ラベルの表示
- ストック内ブロックの描画

#### インタラクション

- 手札からストック枠へのドラッグ&ドロップ
- ストック枠から手札へのドラッグ&ドロップ
- スワップ処理（既存ブロックがある場合）
- ドラッグオーバー時のハイライト

#### 状態管理

```typescript
interface DeckState {
  // 既存のフィールド...
  stockSlot: Piece | null  // ストックに保管されているピース
}
```

#### ロジック

- `moveToStock(piece)`: 手札からストックへ移動
- `moveFromStock()`: ストックから手札へ移動
- `swapWithStock(piece)`: 手札とストックをスワップ
- ラウンド開始時のストッククリア

---

## 3. UI画面（未実装）

### ラウンド進行画面（round-progress-screen）

JSVersionSpecで定義されているが、現行プロジェクトでは未実装。

**機能**:
- セット番号の表示
- 3つのラウンドカード（雑魚、エリート、ボス）の表示
- 各ラウンドのクリア済み/現在位置/未到達の状態表示
- ボスカードにはボス条件を表示
- 「ラウンド開始」ボタン

**表示タイミング**:
- ゲーム開始時
- ラウンドクリア後（ショップ画面の後）

### デッキ一覧画面（deck-view-screen）

**機能**:
- 山札のブロック一覧（サイズ順）の表示
- 使用中のブロック一覧（グレーアウト）の表示
- 閉じるボタン

**トリガー**:
- 「デッキ」ボタンのクリック/タップ

### デバッグモーダル

**機能**:
- タブ切り替え（レリック、ゲーム状態、ブロックセット、ラウンド）
- クイックアクション（盤面クリア、全レリック獲得）
- 各種設定変更
- セーブデータ削除ボタン（※これは実装済み）

### ヘッダーUI要素

以下のUI要素が未実装または部分的:

| 要素 | 状態 |
|------|------|
| バージョン表示 | 未確認 |
| 設定アイコン（データリセット） | 未確認 |
| デッキボタン | 未実装 |
| デバッグボタン | 部分的（デバッグウィンドウは別実装あり） |

---

## 4. アニメーション・演出（差分）

### 購入アニメーション

ショップでの商品購入時のカード演出。現行プロジェクトでの実装状況は要確認。

### ゴールド獲得ポップアップ

画面中央に表示 + フェードアウト。現行プロジェクトでの実装状況は要確認。

---

## 5. 技術スタック差分

| 項目 | JSVersionSpec | 現行プロジェクト |
|------|---------------|------------------|
| レンダリング | DOM操作 | Canvas API |
| アーキテクチャ | ES6 Modules不使用、グローバルオブジェクト | React + TypeScript |
| 状態管理 | 各モジュールの内部状態 | useReducer + Context |
| ビルド | なし（直接参照） | Vite |

---

## 実装優先度の推奨

### 高優先度

1. **未実装レリック（7種類）** - ゲームプレイの多様性を大きく向上
2. **ストック機能（hand_stockレリック）** - 戦略性を追加

### 中優先度

3. **ラウンド進行画面** - ゲームフロー理解を助けるUI
4. **デッキ一覧画面** - プレイヤーの戦略立案を支援

### 低優先度

5. **デバッグモーダルの拡充** - 開発・テスト効率向上
6. **ヘッダーUI要素** - 細かいUI改善
7. **アニメーション改善** - ポリッシュ

---

## 更新履歴

- 2026-02-09: 初版作成
