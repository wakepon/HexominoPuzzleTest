# ゲーム概要

## 概要

Wooden Puzzle 風デッキ構築パズルブラウザゲーム。プレイヤーはデッキから引いたブロック（ミノ）を6x6のボードに配置し、ラインを消去してスコアを獲得する。24ラウンド制で、各ラウンドで目標スコアを達成するとショップでデッキを強化できる。

## 基本情報

- **プラットフォーム**: ブラウザ（デスクトップ・モバイル対応）
- **操作方法**: マウス / タッチ操作 / キーボード（デバッグ）
- **技術スタック**: React + TypeScript、Canvas API
- **デバイス対応**: レスポンシブデザイン（画面サイズに応じたレイアウト調整）

## ゲームの目的

24ラウンド制のパズルゲーム。各ラウンドで目標スコアを達成し、ショップでデッキを強化しながら最終ラウンドのクリアを目指す。

## 基本ルール

### ボード

- 6x6のグリッド形式のボード
- 各セルは「空」または「埋まっている」の2状態
- ボードは木目調のビジュアルスタイルで表示される
- 各ラウンド開始時にボードはリセットされる

### デッキシステム

- ゲーム開始時に初期デッキが作成される
- デッキからランダムに3つのミノが手札として配られる
- ミノを配置すると残り配置回数が減少する
- 手札3つが全て空になると、デッキから新たに3つ引かれる
- デッキが足りない場合は自動的にシャッフルして引き直す
- 各ラウンドで配置可能な回数が設定されている

### ミノ（ブロック）

- 画面下部に3つのブロックスロットが配置されている
- 各スロットには異なる形状のミノが配置される
- ミノは6種類のカテゴリに分類される:
  - モノミノ: 1セル
  - ドミノ: 2セル
  - トロミノ: 3セル
  - テトロミノ: 4セル
  - ペントミノ: 5セル
  - ヘキソミノ: 6セル
- 全307種類のミノ定義が存在（回転・反転を含む）

### ミノ配置

- ミノをドラッグしてボード上に移動できる
- 配置可能な位置では半透明茶色のプレビューが表示される
- 配置不可能な位置では半透明赤色のプレビューが表示される
- ドロップ時に配置可能であればミノがボードに配置され、スロットから削除される
- 配置不可能な場合はミノが元のスロットに戻る
- ミノを配置すると残り配置回数が1減少する

### ライン消去とスコア

- 行または列のすべてのセルが埋まると、そのラインが消去される
- 複数のラインを同時に消去できる（行と列の両方）
- ライン消去時にアニメーション（回転・上昇・縮小）が表示される
- スコア計算式: 消去されたセル数 × 消去されたライン数
- スコアは画面上部中央に表示される

### ラウンドシステム

- 全24ラウンド構成
- 各ラウンドには目標スコアが設定されている
- 目標スコアは画面上部中央に表示される
- 目標スコア達成でラウンドクリア
- 残り配置回数が0になると目標未達成でゲームオーバー
- 最終ラウンドをクリアするとゲームクリア

### ゴールドシステム

- ラウンドクリア時に残り配置回数に応じたゴールドを獲得
- ゴールドは画面左上に金色で表示される
- ゴールドはショップでミノの購入に使用される
- ゴールドは次のラウンドに持ち越される

### ショップ

- ラウンドクリア後にショップフェーズに移行（最終ラウンドを除く）
- 3種類のミノが販売される:
  - 小サイズ: モノミノ/ドミノ/トロミノから1つ
  - 中サイズ: テトロミノ/ペントミノから1つ
  - 大サイズ: ペントミノ/ヘキソミノから1つ
- 各ミノの価格はセル数と同じ
- 購入したミノはデッキに追加される
- ショップを出ると次のラウンドが開始される

## ゲームフェーズ

### playing（プレイ中）

- 通常のゲームプレイ状態
- ミノの配置とライン消去が可能

### round_clear（ラウンドクリア）

- 目標スコア達成時に自動的に遷移
- ゴールド獲得演出が表示される
- 一定時間後に自動的にショップまたはゲームクリアに遷移

### shopping（ショップ）

- ミノの購入が可能
- 「ショップを出る」ボタンで次のラウンドに進む

### game_over（ゲームオーバー）

- 残り配置回数が0で目標未達成の場合に遷移
- 到達ラウンド、最終スコア、獲得ゴールドが表示される
- 「リセット」ボタンでゲーム再開

### game_clear（ゲームクリア）

- 最終ラウンド（24ラウンド）をクリアした場合に遷移
- 最終的な獲得ゴールドが表示される
- 「リセット」ボタンでゲーム再開

## 操作方法

### デスクトップ（マウス）

1. ブロックをクリック&ホールドする
2. マウスを移動してボード上の配置位置にドラッグする
3. マウスボタンを離してドロップする
4. ショップでミノをクリックして購入する
5. Shift + 1 でデバッグウィンドウの表示/非表示を切り替え

### モバイル（タッチ）

1. ブロックをタッチ&ホールドする
2. 指を移動してボード上の配置位置にドラッグする
3. 指を離してドロップする
4. ショップでミノをタップして購入する

### デバッグウィンドウ

- Shift + 1 キーでデッキの内容を表示/非表示
- デッキ内のミノIDと次に引かれるミノがハイライト表示される
- 開発・デバッグ用の機能

## ビジュアルスタイル

- 木目調のデザイン
- ボード背景: ダークブラウン
- セル背景: タン色
- ブロック: シエナ系の茶色（ハイライト・影付き）
- プレビュー: 半透明（緑/赤）
- ゴールド表示: 金色
- オーバーレイ: 半透明黒背景

## 関連ファイル

- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/constants.ts` - ゲーム定数（グリッドサイズ、色定義、ラウンド設定等）
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/types.ts` - 型定義（GameState、GamePhase等）
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/minoDefinitions.ts` - ミノ形状定義（全307種類）
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/deckLogic.ts` - デッキ管理ロジック
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/roundLogic.ts` - ラウンド・ゴールド計算
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/shopLogic.ts` - ショップロジック
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/lib/game/lineLogic.ts` - ライン消去とスコア計算
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/hooks/useGame.ts` - ゲーム状態管理
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/components/GameContainer.tsx` - ゲームコンテナコンポーネント
- `/Users/kenwatanabe/Projects/HexominoPuzzleTest/src/components/GameCanvas.tsx` - Canvas描画コンポーネント

## 更新履歴

- 2026-02-01: 初版作成
- 2026-02-01: ミノシステム、ライン消去、スコアシステムを追加
- 2026-02-02: デッキシステム、ラウンド制、ゴールド、ショップ、ゲームフェーズ、デバッグウィンドウを追加
